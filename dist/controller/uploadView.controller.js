sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ColumnListItem","sap/m/Input","sap/base/util/deepExtend","sap/m/CheckBox"],function(e,t,o,s,a,i,l){"use strict";return e.extend("exceluploadproject.controller.uploadView",{onInit:function(){this._bEditMode=false;var e=new t({bEditMode:false,editButtonText:"Edit"});this.getView().setModel(e,"view");this.getView().setModel(new t({excelRows:[]}),"TableModel");var o=new t;this.getView().setModel(o,"csvModel");this.onReadCSV();this.oTable=this.byId("idCSVTable");this.oReadOnlyTemplate=this.byId("idCSVTable").getBindingInfo("items").template.clone();this.rebindTable(this.oReadOnlyTemplate,"Navigation");this.oEditableTemplate=new s({cells:[new a({value:"{csvModel>id}"}),new a({value:"{csvModel>name}",editable:"{= ${csvModel>selected} }"}),new a({value:"{csvModel>place}",editable:"{= ${csvModel>selected} }"}),new l({selected:"{csvModel>selected}"})]})},onReadCSV:function(){var e=this.getOwnerComponent().getModel();e.read("/CsvRows",{success:function(e){this.getView().getModel("csvModel").setProperty("/csvRows",e.results)}.bind(this),error:function(e){sap.m.MessageToast.show(e.message);console.error("Error details:",e)}})},onExcelUpload:function(e){var t=e.getParameter("files")[0];if(!t){o.show("Please choose an Excel file.");return}var s=new FileReader;s.onload=function(e){var t=new Uint8Array(e.target.result);var s=XLSX.read(t,{type:"array"});var a=s.Sheets[s.SheetNames[0]];var i=XLSX.utils.sheet_to_json(a);var l=i.map(e=>Object.fromEntries(Object.entries(e).map(([e,t])=>[e.toLowerCase(),t])));var r=l.map(e=>Object.fromEntries(Object.entries(e).map(([e,t])=>[e.replace(/\s+/g,""),t])));this.getView().getModel("TableModel").setProperty("/excelRows",r);o.show("Excel loaded successfully!")}.bind(this);s.readAsArrayBuffer(t)},onSaveToHana:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("TableModel").getProperty("/excelRows");t.forEach(function(t){var o={name:t.name,place:t.place};e.create("/CsvRows",o,{success:function(){console.log("Created:",o)},error:function(e){console.error("Error creating record:",e)}})});o.show("Data sent to backend!")},rebindTable:function(e,t){this.oTable.bindItems({path:"csvModel>/csvRows",template:e,templateShareable:true,key:"csvModel>id"}).setKeyboardMode(t)},onEdit:function(){var e=this.getView().getModel("view");var t=this.getView().getModel("csvModel");var s=t.getProperty("/csvRows");this._bEditMode=!this._bEditMode;e.setProperty("/bEditMode",this._bEditMode);e.setProperty("/editButtonText",this._bEditMode?"Cancel Edit":"Edit");if(this._bEditMode){s.forEach(function(e){e.selected=e.name==="Ravi111"});o.show("Edit mode enabled")}else{s.forEach(function(e){e.selected=false});o.show("View mode enabled")}t.setProperty("/csvRows",s);this.aProductCollection=i([],this.getView().getModel("csvModel").getProperty("/csvRows"));this.rebindTable(this.oEditableTemplate,"Edit")},onCancel:function(){var e=this.getView().getModel("csvModel").getProperty("/csvRows");this.getView().getModel("csvModel").setProperty("/csvRows",e);this.rebindTable(this.oReadOnlyTemplate,"Navigation")},onSave:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("csvModel").getProperty("/csvRows");t.forEach(function(t){var o="/CsvRows("+t.id+")";var s={name:t.name,place:t.place};e.update(o,s,{success:function(){console.log("Record "+t.id+" updated successfully")},error:function(e){console.error("Error updating record "+t.id,e);sap.m.MessageToast.show("Update failed for record "+t.id)}})});this.onReadCSV();sap.m.MessageToast.show("All records updated successfully!");this.rebindTable(this.oReadOnlyTemplate,"Navigation")}})});
//# sourceMappingURL=uploadView.controller.js.map